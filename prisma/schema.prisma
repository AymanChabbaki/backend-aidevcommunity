generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  passwordHash    String         @map("password_hash")
  displayName     String         @map("display_name")
  role            Role           @default(USER)
  photoUrl        String?        @map("photo_url")
  bio             String?        @db.Text
  skills          Json?
  github          String?
  linkedin        String?
  twitter         String?
  publicProfile   Boolean        @default(true) @map("public_profile")
  locale          String         @default("en")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  staffRole       String?        @map("staff_role")
  studyLevel      StudyLevel?    @map("study_level")
  studyProgram    StudyProgram?  @map("study_program")
  auditLogs       AuditLog[]
  organizedEvents Event[]        @relation("EventOrganizer")
  formResponses   FormResponse[]
  notifications   Notification[]
  refreshTokens   RefreshToken[]
  registrations   Registration[]
  votes           Vote[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "refresh_tokens_user_id_fkey")
  @@map("refresh_tokens")
}

model Event {
  id            String         @id @default(uuid())
  title         String
  description   String         @db.Text
  locationType  LocationType   @default(PHYSICAL) @map("location_type")
  locationText  String         @map("location_text")
  startAt       DateTime       @map("start_at")
  endAt         DateTime       @map("end_at")
  capacity      Int
  imageUrl      String?        @map("image_url") @db.VarChar(500)
  tags          Json?
  organizerId   String         @map("organizer_id")
  status           EventStatus    @default(UPCOMING)
  category         String?
  speaker          String?
  requiresApproval Boolean        @default(false) @map("requires_approval")
  eligibleLevels   Json?          @map("eligible_levels")
  eligiblePrograms Json?          @map("eligible_programs")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  organizer     User           @relation("EventOrganizer", fields: [organizerId], references: [id])
  forms         Form[]
  registrations Registration[]

  @@index([organizerId], map: "events_organizer_id_fkey")
  @@map("events")
}

model Registration {
  id          String             @id @default(uuid())
  eventId     String             @map("event_id")
  userId      String             @map("user_id")
  status      RegistrationStatus @default(REGISTERED)
  badgeUrl    String?            @map("badge_url")
  qrToken       String             @unique @map("qr_token")
  checkedInAt   DateTime?          @map("checked_in_at")
  reviewedBy    String?            @map("reviewed_by")
  reviewedAt    DateTime?          @map("reviewed_at")
  reviewComment String?            @map("review_comment") @db.Text
  createdAt     DateTime           @default(now()) @map("created_at")
  event       Event              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([userId], map: "registrations_user_id_fkey")
  @@map("registrations")
}

model Form {
  id          String         @id @default(uuid())
  title       String
  description String?        @db.Text
  fields      Json
  eventId     String?        @map("event_id")
  createdBy   String         @map("created_by")
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")
  responses   FormResponse[]
  event       Event?         @relation(fields: [eventId], references: [id])

  @@index([eventId], map: "forms_event_id_fkey")
  @@map("forms")
}

model FormResponse {
  id          String   @id @default(uuid())
  formId      String   @map("form_id")
  userId      String?  @map("user_id")
  answers     Json
  attachments Json?
  createdAt   DateTime @default(now()) @map("created_at")
  form        Form     @relation(fields: [formId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [userId], references: [id])

  @@index([formId], map: "form_responses_form_id_fkey")
  @@index([userId], map: "form_responses_user_id_fkey")
  @@map("form_responses")
}

model Poll {
  id         String         @id @default(uuid())
  question   String
  options    Json
  startAt    DateTime       @map("start_at")
  endAt      DateTime       @map("end_at")
  visibility PollVisibility @default(PUBLIC)
  status     PollStatus     @default(ACTIVE)
  createdBy  String         @map("created_by")
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")
  votes      Vote[]

  @@map("polls")
}

model Vote {
  id        String   @id @default(uuid())
  pollId    String   @map("poll_id")
  userId    String   @map("user_id")
  optionId  String   @map("option_id")
  createdAt DateTime @default(now()) @map("created_at")
  poll      Poll     @relation(fields: [pollId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([pollId, userId])
  @@index([userId], map: "votes_user_id_fkey")
  @@map("votes")
}

model Notification {
  id        String           @id @default(uuid())
  userId    String           @map("user_id")
  type      NotificationType
  title     String
  content   String           @db.Text
  readAt    DateTime?        @map("read_at")
  createdAt DateTime         @default(now()) @map("created_at")
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "notifications_user_id_fkey")
  @@map("notifications")
}

model AuditLog {
  id        String   @id @default(uuid())
  actorId   String   @map("actor_id")
  action    String
  entity    String
  entityId  String   @map("entity_id")
  metadata  Json?
  createdAt DateTime @default(now()) @map("created_at")
  actor     User     @relation(fields: [actorId], references: [id])

  @@index([actorId], map: "audit_logs_actor_id_fkey")
  @@map("audit_logs")
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     Json
  category  String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

model HomeContent {
  id               String   @id @default(uuid())
  heroTitle        String   @map("hero_title") @db.VarChar(200)
  heroSubtitle     String   @map("hero_subtitle") @db.VarChar(500)
  heroCtaText      String   @default("Get Started") @map("hero_cta_text") @db.VarChar(50)
  heroCtaLink      String   @default("/events") @map("hero_cta_link") @db.VarChar(200)
  featuredEventIds Json     @map("featured_event_ids")
  showPastEvents   Boolean  @default(true) @map("show_past_events")
  statsEnabled     Boolean  @default(true) @map("stats_enabled")
  totalEvents      Int      @default(0) @map("total_events")
  totalMembers     Int      @default(0) @map("total_members")
  activeProjects   Int      @default(0) @map("active_projects")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("home_content")
}

model ContactMessage {
  id        String    @id @default(uuid())
  name      String
  email     String
  subject   String?
  message   String    @db.Text
  status    String    @default("unread")
  readAt    DateTime? @map("read_at")
  createdAt DateTime  @default(now()) @map("created_at")

  @@map("contact_messages")
}

enum Role {
  USER
  STAFF
  ADMIN
}

enum LocationType {
  PHYSICAL
  VIRTUAL
  HYBRID
}

enum EventStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

enum RegistrationStatus {
  PENDING
  REGISTERED
  APPROVED
  REJECTED
  CANCELLED
  WAITLIST
}

enum StudyLevel {
  BACHELOR
  MASTER
  DOCTORATE
}

enum StudyProgram {
  BACHELOR_S1
  BACHELOR_S2
  BACHELOR_S3
  BACHELOR_S4
  BACHELOR_S5
  BACHELOR_S6
  MASTER_M1
  MASTER_M2
  DOCTORATE_Y1
  DOCTORATE_Y2
  DOCTORATE_Y3
  DOCTORATE_Y4
}

enum PollVisibility {
  PUBLIC
  MEMBERS_ONLY
  ANONYMOUS
}

enum PollStatus {
  ACTIVE
  CLOSED
}

enum NotificationType {
  EVENT_CONFIRMATION
  EVENT_REMINDER
  EVENT_UPDATE
  SYSTEM
  FORM_SUBMISSION
}
